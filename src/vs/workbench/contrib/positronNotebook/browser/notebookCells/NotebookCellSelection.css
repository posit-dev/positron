/*---------------------------------------------------------------------------------------------
 *  Copyright (C) 2025 Posit Software, PBC. All rights reserved.
 *  Licensed under the Elastic License 2.0. See LICENSE.txt for license information.
 *--------------------------------------------------------------------------------------------*/

/*
 * Notebook Cell Selection and Border Styles
 *
 * This CSS file defines the border and selection styles for notebook cells.
 * Borders change color based on cell states (selected, editing, hover)
 * while maintaining a consistent width to prevent layout shifts.
 *
 * It also includes styles for assistant cell highlight animations used when AI modifies cells.
 */

/* === Code Cells: Editor + Footer Container === */

.positron-notebook-editor-section {
	border: 1px solid var(--vscode-positronNotebook-border-color);
	border-radius: var(--vscode-positronNotebook-cell-radius);
	border-bottom-left-radius: 0;
	border-bottom-right-radius: 0;
	border-bottom: none; /* Footer connects seamlessly to outputs below */
}

.positron-notebook-code-cell .positron-notebook-editor-container {
	overflow: hidden; /* Clip editor content to rounded corners */
	border-radius: var(--vscode-positronNotebook-cell-radius);
	border-bottom-left-radius: 0;
	border-bottom-right-radius: 0;
}

/* === Code Cells: Outputs Container === */

.positron-notebook-code-cell .positron-notebook-cell-outputs {
	border: 1px solid var(--vscode-positronNotebook-border-color);
	border-top: none;
	/* Seamlessly connect the output border to the code cell editor+footer */
	border-radius: var(--vscode-positronNotebook-cell-radius);
	border-top-left-radius: 0;
	border-top-right-radius: 0;
	overflow: hidden;
}

/* === Selection States: Selected === */

.positron-notebook-cell.selected .positron-notebook-editor-section,
.positron-notebook-code-cell.selected .positron-notebook-cell-outputs {
	border-color: var(--vscode-focusBorder);
}

/* === Selection States: Editing === */

.positron-notebook-cell.editing .positron-notebook-editor-section,
.positron-notebook-code-cell.editing .positron-notebook-cell-outputs {
	border-color: var(--vscode-focusBorder);
}

/* === Selection States: Hover (when not selected/editing) === */

.positron-notebook-cell:not(.selected):not(.editing):hover .positron-notebook-editor-section,
.positron-notebook-code-cell:not(.selected):not(.editing):hover .positron-notebook-cell-outputs {
	border-color: var(--vscode-editorWidget-border);
}

/* === Special Case: Code Cells with No Outputs === */

.positron-notebook-code-cell:has(.positron-notebook-outputs-section.no-outputs) .positron-notebook-editor-section {
	border-radius: var(--vscode-positronNotebook-cell-radius);
	border-bottom: 1px solid var(--vscode-positronNotebook-border-color);
}

/* Make bottom border of code cell footer transparent when there are no outputs to avoid double border while maintaining static height */
.positron-notebook-code-cell:has(.positron-notebook-outputs-section.no-outputs) .positron-notebook-code-cell-footer {
	border-bottom-color: transparent;
}

/* Update the border color for code cells with no outputs based on the selection state */
.positron-notebook-cell.selected:has(.positron-notebook-outputs-section.no-outputs) .positron-notebook-editor-section,
.positron-notebook-cell.editing:has(.positron-notebook-outputs-section.no-outputs) .positron-notebook-editor-section {
	border-bottom-color: var(--vscode-focusBorder);
}

.positron-notebook-cell:not(.selected):not(.editing):hover:has(.positron-notebook-outputs-section.no-outputs) .positron-notebook-editor-section {
	border-bottom-color: var(--vscode-editorWidget-border);
}

/* === Markdown Cells: Editor (when shown) === */

.positron-notebook-markdown-cell .positron-notebook-editor-container:not(.editor-hidden) {
	border: 1px solid var(--vscode-positronNotebook-border-color);
	border-radius: var(--vscode-positronNotebook-cell-radius);
	overflow: hidden;
}

.positron-notebook-cell.selected .positron-notebook-editor-container:not(.editor-hidden),
.positron-notebook-cell.editing .positron-notebook-editor-container:not(.editor-hidden) {
	border-color: var(--vscode-focusBorder);
}

.positron-notebook-cell:not(.selected):not(.editing):hover .positron-notebook-editor-container:not(.editor-hidden) {
	border-color: var(--vscode-editorWidget-border);
}

/* === Markdown Cells: Rendered Content (when editor hidden) === */

/* Base border style that is transparent to prevent layout shift on hover */
.positron-notebook-markdown-cell .positron-notebook-cell-outputs {
	border: 1px solid transparent;
	border-radius: var(--vscode-positronNotebook-cell-radius);
}

/* Show border when selected or editing */
.positron-notebook-markdown-cell.selected .positron-notebook-cell-outputs,
.positron-notebook-markdown-cell.editing .positron-notebook-cell-outputs {
	border-color: var(--vscode-focusBorder);
}

/* Show border on hover */
.positron-notebook-markdown-cell:not(.selected):not(.editing):hover .positron-notebook-cell-outputs {
	border-color: var(--vscode-editorWidget-border);
}

/* Empty markdown cell always shows dashed border */
.positron-notebook-markdown-cell .positron-notebook-cell-outputs:has(.empty-output-msg) {
	border-style: dashed;
	border-color: var(--vscode-positronNotebook-border-color);
}


/* Assistant cell highlight animation - used when AI modifies cells */
.positron-notebook-cell.assistant-highlight {
	position: relative;
}

.positron-notebook-cell.assistant-highlight::after {
	content: "";
	position: absolute;
	inset: 0;
	background-color: var(--vscode-button-background);
	border-radius: var(--vscode-positronNotebook-cell-radius);
	pointer-events: none;
	/* Must be higher than cell content (action bar is z-index: 10) to be visible as overlay */
	z-index: 15;
	opacity: 0;
	animation: assistant-flash 1.5s ease-in-out;
	animation-fill-mode: forwards;
}

@keyframes assistant-flash {
	0%, 100% { opacity: 0; }
	25%, 75% { opacity: 0.2; }
}

/* Operation-specific highlight colors - all use the same animation */
.positron-notebook-cell.assistant-highlight.assistant-highlight-add::after {
	background-color: var(--vscode-diffEditor-insertedLineBackground, var(--vscode-diffEditor-insertedTextBackground));
}

.positron-notebook-cell.assistant-highlight.assistant-highlight-modify::after {
	background-color: var(--vscode-button-background);
}

/* Note: Delete animation moved to sentinel implementation in Phase 5 */

/* High contrast theme variants - use border instead of background overlay */
.hc-black .positron-notebook-cell.assistant-highlight::after,
.hc-light .positron-notebook-cell.assistant-highlight::after {
	background-color: transparent;
	border: 2px solid var(--vscode-focusBorder);
	animation: assistant-flash-hc 1.5s ease-in-out;
	animation-fill-mode: forwards;
}

.hc-black .positron-notebook-cell.assistant-highlight.assistant-highlight-add::after,
.hc-light .positron-notebook-cell.assistant-highlight.assistant-highlight-add::after {
	border-color: var(--vscode-diffEditor-insertedLineBackground, var(--vscode-editorOverviewRuler-addedForeground));
}

@keyframes assistant-flash-hc {
	0%, 100% { opacity: 0; }
	25%, 75% { opacity: 1; }
}

/* Accessibility - disable animations for users who prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
	.positron-notebook-cell.assistant-highlight::after {
		animation: none;
		opacity: 0;
	}
}
