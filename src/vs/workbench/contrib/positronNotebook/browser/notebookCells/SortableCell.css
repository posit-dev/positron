/*---------------------------------------------------------------------------------------------
 *  Copyright (C) 2024-2026 Posit Software, PBC. All rights reserved.
 *  Licensed under the Elastic License 2.0. See LICENSE.txt for license information.
 *--------------------------------------------------------------------------------------------*/

/* Drag handle for sortable cells */
.cell-drag-handle {
	position: absolute;
	left: -13px; /* Aligned with left gutter: -25px + 12px cell margin = -13px from sortable-cell */
	top: 4px;
	width: 16px;
	height: 24px;
	display: flex;
	align-items: center;
	justify-content: center;
	cursor: grab;
	opacity: 0;
	transition: opacity 0.15s ease;
	color: var(--vscode-foreground);
	border-radius: 3px;
	border: none;
	background: transparent;
	padding: 0;
	z-index: 10; /* Ensure handle is above cell content */
}

/* Ensure drag handle isn't clipped */
.sortable-cell {
	overflow: visible;
}

.sortable-cell:hover .cell-drag-handle,
.cell-drag-handle:focus-visible {
	opacity: 0.6;
}

.cell-drag-handle:hover {
	opacity: 1;
	background: var(--vscode-toolbar-hoverBackground);
}

.cell-drag-handle .codicon {
	cursor: inherit;
}

.cell-drag-handle:active {
	cursor: grabbing;
}

/* Global cursor during drag operation */
body.dragging-notebook-cell,
body.dragging-notebook-cell * {
	cursor: grabbing !important;
}

/* Cell being dragged - visible with visual treatment to indicate it's being moved */
.sortable-cell.dragging {
	position: relative;
	z-index: 100;
	opacity: 0.5; /* Fade original position to indicate "this is being moved" */
	--_drag-lift-x: 4px;
	--_drag-lift-y: -3px;
}

/* Apply drag visual treatment to inner cell element so it matches natural boundaries.
 * Lift effect (transform) is on inner element to avoid conflicting with FLIP animations
 * which apply transforms to the outer .sortable-cell wrapper. */
.sortable-cell.dragging .positron-notebook-cell {
	box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
	background: var(--vscode-editor-background);
	transform: translate(var(--_drag-lift-x), var(--_drag-lift-y)); /* Subtle lift effect - hover off the page */
	transition: transform 0.15s ease-out;
}

/* Respect reduced motion preferences for lift animation */
@media (prefers-reduced-motion: reduce) {
	.sortable-cell.dragging .positron-notebook-cell {
		transition: none;
	}
}

/*
 * Drag outline overlay - creates a unified border around the cell content
 * using a pseudo-element positioned relative to the cell container
 */
.sortable-cell.dragging .positron-notebook-cell::before {
	content: '';
	position: absolute;
	/* Inset positioned just inside the cell's margin area */
	top: -2px;
	right: -2px;
	bottom: -2px;
	left: -2px;
	border: 2px solid var(--vscode-editorInfo-foreground);
	border-radius: calc(var(--vscode-positronNotebook-cell-radius) + 2px);
	pointer-events: none;
	z-index: 1;
}

/* Hide cell action bar during drag for cleaner appearance */
.sortable-cell.dragging .positron-notebooks-cell-action-bar {
	opacity: 0;
}

/* Collapsed line for non-primary dragged cells in multi-drag */
.sortable-cell.collapsed-drag {
	overflow: hidden;
	/* scaleY from transform handles the visual collapse */
}

.sortable-cell.collapsed-drag .positron-notebook-cell {
	visibility: hidden; /* Hide content but keep space for scaleY */
}

/* Multi-drag indicators rendered on the primary dragged cell (unscaled). */
.sortable-cell.dragging.multi-drag-primary-indicator-above::before,
.sortable-cell.dragging.multi-drag-primary-indicator-below::after {
	content: '';
	position: absolute;
	/* Match dragged outline geometry: cell margin-left (12px) plus outline inset (-2px). */
	left: 10px;
	right: -2px;
	transform: translateX(var(--_drag-lift-x, 0px));
	height: 3px;
	background: var(--vscode-editorInfo-foreground);
	border-radius: 2px;
	opacity: 0.7;
	pointer-events: none;
	z-index: 101;
}

.sortable-cell.dragging.multi-drag-primary-indicator-above::before {
	/* Account for drag lift so this stays above (not on) the dragged border. */
	top: calc(-6px + var(--_drag-lift-y, 0px));
}

.sortable-cell.dragging.multi-drag-primary-indicator-below::after {
	top: calc(100% + 2px);
}
