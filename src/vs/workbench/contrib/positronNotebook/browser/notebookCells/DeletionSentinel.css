/*---------------------------------------------------------------------------------------------
 *  Copyright (C) 2025 Posit Software, PBC. All rights reserved.
 *  Licensed under the Elastic License 2.0. See LICENSE.txt for license information.
 *--------------------------------------------------------------------------------------------*/

.deletion-sentinel {
	position: relative;
	margin-left: 12px; /* Match cell left margin */
	/* Match spacing that AddCellButtons provides between live cells */
	margin-bottom: calc(
		var(--_positron-notebook-add-cell-buttons-height) +
			var(--_positron-notebook-cell-gap)
	);
	border-radius: var(--vscode-positronNotebook-cell-radius);
	animation: sentinel-slide-in 0.3s ease-out;
}

/* Red deletion flash animation overlay */
.deletion-sentinel-flash {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: var(--vscode-diffEditor-removedLineBackground, var(--vscode-diffEditor-removedTextBackground));
	border-radius: var(--vscode-positronNotebook-cell-radius);
	pointer-events: none;
	animation: deletion-flash-fade 2s ease-in-out forwards;
	z-index: 1;
}

@keyframes deletion-flash-fade {
	0% { opacity: 0; }
	25% { opacity: 0.3; }
	100% { opacity: 0; }
}

.deletion-sentinel-content {
	position: relative;
	display: flex;
	z-index: 2;
}

/* Left selection bar - greyed out version */
.deletion-sentinel-selection-bar {
	width: 7px;
	background-color: var(--vscode-editorWidget-border);
	opacity: 0.5;
	border-top-left-radius: var(--vscode-positronNotebook-cell-radius);
	border-bottom-left-radius: var(--vscode-positronNotebook-cell-radius);
	flex-shrink: 0;
}

/* Main cell container */
.deletion-sentinel-cell-container {
	flex: 1;
	background: var(--vscode-notebook-cellEditorBackground, var(--vscode-editor-background));
	border: var(--vscode-positronNotebook-border);
	border-left: none;
	border-top-right-radius: var(--vscode-positronNotebook-cell-radius);
	border-bottom-right-radius: var(--vscode-positronNotebook-cell-radius);
	opacity: 0.6; /* Make the whole cell look faded */
	overflow: hidden;
}

/* Header section with message and actions */
.deletion-sentinel-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: 6px 12px;
	background: var(--vscode-notifications-background);
	border-bottom: 1px solid var(--vscode-widget-border);
	gap: 12px;
}

.deletion-sentinel-message {
	color: var(--vscode-foreground);
	font-size: 12px;
	opacity: 0.8;
}

.deletion-sentinel-actions {
	display: flex;
	gap: 8px;
}

.deletion-sentinel-undo,
.deletion-sentinel-dismiss {
	min-width: 50px;
	padding: 2px 8px;
	font-size: 11px;
}

/* Code preview section */
.deletion-sentinel-code-preview {
	padding: 8px 16px;
	min-height: 2em;
	max-height: 4.5em; /* Roughly 3 lines */
	overflow: hidden;
	position: relative;
	font-family: var(
		--vscode-positronNotebook-text-output-font-family,
		var(--monaco-monospace-font)
	);
	font-size: var(--vscode-positronNotebook-text-output-font-size);
}

/* Fade out effect for truncated content */
.deletion-sentinel-code-preview::after {
	content: '';
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	height: 1.5em;
	background: linear-gradient(
		to bottom,
		transparent,
		var(--vscode-notebook-cellEditorBackground, var(--vscode-editor-background))
	);
	pointer-events: none;
}

/* Code/content preview - plain greyed-out text */
.deletion-sentinel-code-preview .deletion-sentinel-code-text {
	margin: 0;
	white-space: pre;
	overflow: hidden;
	text-overflow: ellipsis;
	opacity: 0.7;
	color: var(--vscode-foreground);
}

/* Empty cell placeholder */
.deletion-sentinel-code-preview .empty-cell-placeholder {
	font-style: italic;
	opacity: 0.5;
	color: var(--vscode-foreground);
}

@keyframes sentinel-slide-in {
	from {
		opacity: 0;
		transform: translateY(-8px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

/* High contrast theme support */
.hc-black .deletion-sentinel-cell-container,
.hc-light .deletion-sentinel-cell-container {
	border: 2px solid var(--vscode-widget-border);
	opacity: 0.8;
}

.hc-black .deletion-sentinel-flash,
.hc-light .deletion-sentinel-flash {
	background-color: transparent;
	border: 2px solid var(--vscode-diffEditor-removedLineBackground, var(--vscode-editorOverviewRuler-deletedForeground));
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
	.deletion-sentinel {
		animation: none;
	}
	.deletion-sentinel-flash {
		animation: none;
		opacity: 0;
	}
}
